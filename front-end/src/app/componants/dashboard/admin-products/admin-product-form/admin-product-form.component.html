<!-- Notification -->
<div *ngIf="messageEn || messageAr" class="notification-container fade-in">
  <div class="alert alert-warning d-flex justify-content-between align-items-center">
    <div>
      <strong *ngIf="messageEn">{{ messageEn }}</strong><br>
      <span *ngIf="messageAr" class="text-muted">{{ messageAr }}</span>
    </div>
    <button type="button" class="btn-close" aria-label="Close" (click)="clearMessage()"></button>
  </div>
</div>

<div class="modal-header bg-primary text-white">
  <h5 class="modal-title">
    {{ mode === 'add'
    ? '‚ûï Add Product'
    : mode === 'edit'
      ? '‚úèÔ∏è Edit Product'
      : 'üëÅÔ∏è View Product' }}
  </h5>
  <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="activeModal.dismiss()"></button>
</div>

<div class="modal-body bg-light">
  <form (submit)="$event.preventDefault()">
  <div class="row g-3">
    <fieldset [disabled]="isReadOnly()">

      <!-- Name -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Name</label>
        <input type="text" class="form-control shadow-sm"
               [(ngModel)]="product.name" name="name"
               placeholder="Enter product name">
      </div>

      <!-- Price -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Price</label>
        <input type="number" class="form-control shadow-sm"
               [(ngModel)]="product.price" name="price"
               placeholder="Enter product price">
      </div>

      <!-- Description -->
      <div class="col-12">
        <label class="form-label fw-bold">Description</label>
        <textarea rows="2" class="form-control shadow-sm"
                  [(ngModel)]="product.description" name="description"
                  placeholder="Write short description..."></textarea>
      </div>

      <!-- Image Upload -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Product Image</label>
        <div class="card shadow-sm border-0">
          <div class="card-body text-center p-3">
            <!-- Current image -->
            <div *ngIf="product.image" class="mb-2">
              <img
                [src]="'http://localhost:8081/uploads/' + product.image"
                alt="Product Image"
                class="img-thumbnail rounded-3"
                style="width: 160px; height: 160px; object-fit: cover;">
            </div>

            <!-- Folder selection -->
            <div class="input-group mb-2" *ngIf="!isReadOnly()">
              <span class="input-group-text bg-white"><i class="fa fa-folder text-warning"></i></span>
              <select class="form-select" [(ngModel)]="selectedFolder" name="folder">
                <option value="cold-drinks">cold-drinks</option>
                <option value="foods">foods</option>
                <option value="hot-drinks">hot-drinks</option>
                <option value="other-foods">other-foods</option>
                <option value="sweets">sweets</option>
              </select>
            </div>

            <!-- Upload button -->
            <label class="btn btn-outline-warning btn-sm w-100 fw-bold" *ngIf="!isReadOnly()">
              <i class="fa fa-upload me-1"></i> {{ product.image ? 'Change Image' : 'Upload Image' }}
              <input type="file" hidden (change)="$event.stopPropagation(); onFileSelected($event)">
            </label>

<!--            <small class="text-muted d-block mt-1">-->
<!--              JPG / PNG only ‚Äî recommended size 300√ó300-->
<!--            </small>-->
          </div>
        </div>
      </div>

      <!-- Category -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Category</label>
        <div class="input-group shadow-sm">
          <span class="input-group-text bg-white">
            <i class="fa fa-list text-primary"></i>
          </span>
          <select class="form-select" [(ngModel)]="product.categoryId" name="categoryId">
            <option value="" disabled selected>-- Select Category --</option>
            <option *ngFor="let cat of categories" [value]="cat.id">
              {{ cat.name }} - {{ cat.flag }}
            </option>
          </select>
        </div>
      </div>

      <hr class="my-3">
      <h6 class="text-primary fw-bold">Product Details</h6>

      <!-- Ingredients -->
      <div class="col-12">
        <label class="form-label fw-bold">Ingredients</label>
        <input type="text" class="form-control shadow-sm"
               [(ngModel)]="product.productDetailsDto.ingredients"
               name="ingredients" placeholder="List ingredients...">
      </div>

      <!-- Stock Availability -->
      <div class="col-12">
        <div class="form-check">
          <input type="checkbox" class="form-check-input"
                 [(ngModel)]="product.productDetailsDto.stockAvailability"
                 name="stockAvailability">
          <label class="form-check-label fw-bold">Available in Stock</label>
        </div>
      </div>

      <!-- Special Instructions -->
      <div class="col-12">
        <label class="form-label fw-bold">Special Instructions</label>
        <textarea rows="2" class="form-control shadow-sm"
                  [(ngModel)]="product.productDetailsDto.specialInstructions"
                  name="specialInstructions" placeholder="Optional notes..."></textarea>
      </div>

      <!-- Expiry Date -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Expiry Date</label>
        <input type="date" class="form-control shadow-sm"
               [(ngModel)]="product.productDetailsDto.expiryDate"
               name="expiryDate" [min]="todayDate">
      </div>

    </fieldset>
  </div>
  </form>
</div>

<div class="modal-footer bg-light d-flex justify-content-end align-items-center gap-2">
  <button
    type="button"
    class="btn-cancel fw-bold"
    (click)="activeModal.dismiss()">
    ‚ùå Cancel
  </button>

  <button
    *ngIf="!isReadOnly()"
    type="button"
    class="btn-save fw-bold"
    (click)="save($event)">
    üíæ Save
  </button>

  <button
    *ngIf="isReadOnly()"
    type="button"
    class="btn-action add fw-bold"
    (click)="addToCard(product)">
    üõí Add to Card
  </button>
</div>
